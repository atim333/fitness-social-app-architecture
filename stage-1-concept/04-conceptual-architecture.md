# 4. Концептуальная архитектура

## Обзор

Концептуальная архитектура представляет высокоуровневое видение системы, выделяя ключевые компоненты и их взаимодействие без технических деталей. Система спроектирована с применением принципов Domain-Driven Design (DDD) для точного отражения бизнес-процессов.

## Архитектурные принципы

### 1. Event-Driven Microservices

**Обоснование выбора:**

- **Гибкость:** Независимое развертывание и масштабирование компонентов
- **Устойчивость:** Отказ одного сервиса не приводит к падению всей системы
- **Соответствие требованиям:** Социальные функции требуют асинхронной обработки событий
- **Масштабируемость:** Возможность горизонтального масштабирования по регионам

### 2. Domain-Driven Design (DDD) Approach

**Обоснование:**

- **Бизнес-ориентированность:** Архитектура отражает реальные бизнес-процессы
- **Язык Ubiquitous:** Единый язык между разработчиками и бизнесом
- **Четкие границы:** Ограниченные контексты предотвращают сцепление
- **Сфокусированная сложность:** Core Domain получает максимальное внимание

### 3. Дифференцированный подход к согласованности данных

**Обоснование:**
- **Строгая согласованность (Strong Consistency):** Для финансовых операций, бронирования мест, промоакций
- **Eventual Consistency:** Для социальных лент, рекомендаций, лидербордов
- **Промежуточные уровни:** Read-your-writes, causal consistency для пользовательских данных

## Доменная модель системы (DDD Perspective)

### Ограниченные контексты (Bounded Contexts):

#### 1. **Identity & Authentication Context** (Core Domain)

- **Ответственность:** Управление пользователями, аутентификация, авторизация
- **Почему Core Domain:** Безопасность и идентификация - основа доверия пользователей
- **Ключевые агрегаты:**
  - `User` (агрегат-корень) с `Credentials`, `Permissions`, `Sessions`
  - `SecurityPolicy` (агрегат-корень) с `AccessRules`, `RateLimits`
- **Бизнес-правила:**
  - Минимальная сложность пароля: 12 символов с спец. символами
  - MFA обязательна для доступа к медицинским данным
  - Максимальное количество неудачных попыток: 5
- **Управление данными:**
  - **Тип БД:** PostgreSQL (ACID-транзакции, строгая согласованность)
  - **Уровень изоляции:** Repeatable Read для предотвращения phantom reads
  - **Кэширование:** Redis для активных сессий с TTL 24 часа
  - **Стратегия транзакций:** Локальные ACID транзакции, компенсирующие транзакции для распределенных операций

#### 2. **Workout & Training Context** (Core Domain)

- **Ответственность:** Тренировочные сессии, упражнения, метрики и прогресс
- **Почему Core Domain:** Тренировки - основная функциональность приложения
- **Тип связи с Core:** Partnership (Партнерство) - тесная интеграция с Social Context
- **Ключевые агрегаты:**
  - `TrainingSession` (агрегат-корень) с `Exercises`, `Metrics`, `DeviceReadings`
  - `TrainingPlan` (агрегат-корень) с `Workouts`, `Schedule`, `ProgressionRules`
- **Бизнес-валидация:**
  - Физиологические пределы (ЧСС: 40-220 BPM)
  - Валидация GPS координат
  - Проверка калорийности на соответствие формулам
- **Управление данными:**
  - **Тип БД:** MongoDB (документ-ориентированная, для гибкой схемы тренировок)
  - **Уровень согласованности:** Eventual consistency (приемлема для истории тренировок)
  - **Кэширование:** Redis для активных тренировок с TTL 2 часа
  - **Индексы:** Геопространственные индексы для маршрутов, составные индексы по времени

#### 3. **Social & Community Context** (Core Domain)

- **Ответственность:** Социальные взаимодействия, группы, общение, соревнования
- **Почему Core Domain:** Социальная вовлеченность - ключевой драйвер роста приложения
- **Ключевые агрегаты:**
  - `SocialProfile` (агрегат-корень) с `Connections`, `ActivityFeed`, `PrivacySettings`
  - `CommunityGroup` (агрегат-корень) с `Members`, `Posts`, `Events`, `ModerationQueue`
  - `Challenge` (агрегат-корень) с `Participants`, `Leaderboard`, `Rules`
- **Бизнес-правила:**
  - Ограничение количества участников в группе: 5000
  - Правила контент-модерации (автоматическая + ручная)
  - Приватность данных по умолчанию для новых пользователей
- **Управление данными:**
  - **Тип БД:** PostgreSQL для социального графа + Redis для ленты новостей
  - **Уровень изоляции:** Read Committed для большинства операций, Serializable для финансовых транзакций в челленджах
  - **Кэширование:** Многоуровневое кэширование (L1: локальный, L2: Redis, L3: БД)
  - **Оптимизация:** Materialized views для популярных запросов (топ групп, активные пользователи)
  - 

#### 4. **Health & Device Integration Context**

- **Ответственность:** Интеграция медицинских устройств, сбор и валидация данных о здоровье
- **Тип связи:** Conformist (Конформист) - соответствие медицинским стандартам
- **Ключевые агрегаты:**
  - `MedicalDevice` (агрегат-корень) с `Calibrations`, `Certifications`, `DataStreams`
  - `HealthMetric` (агрегат-корень) с `Measurements`, `Trends`, `MedicalAlerts`
- **Бизнес-правила:**
  - Соответствие стандартам (ISO 13485, HIPAA, GDPR)
  - Валидация данных по возрастным и гендерным нормам
  - Автоматическое обнаружение аномалий (статистические методы)
- **Управление данными:**
  - **Тип БД:** TimescaleDB (PostgreSQL extension) для временных рядов медицинских данных
  - **Уровень изоляции:** Serializable для критических медицинских записей
  - **Хранение:** Холодные данные в S3-совместимом хранилище, горячие в TimescaleDB
  - **Сжатие:** Автоматическое сжатие старых временных рядов

#### 5. **Commerce & Promotions Context**

- **Ответственность:** Продажи товаров, промоакции, интеграция с e-commerce
- **Тип связи:** Customer-Supplier (Заказчик-Поставщик) для Recommendations
- **Ключевые агрегаты:**
  - `Product` (агрегат-корень) с `Inventory`, `PricingTiers`, `RegionalAvailability`
  - `Promotion` (агрегат-корень) с `Rules`, `Conditions`, `Discounts`, `ValidityPeriod`
  - `ShoppingSession` (агрегат-корень) с `CartItems`, `AppliedPromotions`, `ExpiryTime`
- **Бизнес-правила:**
  - Минимальная цена со скидкой: 70% от оригинальной
  - Региональные ограничения для промоакций
  - Автоматическое применение лучшей доступной скидки
- **Управление данными:**
  - **Тип БД:** PostgreSQL для ACID-транзакций + Redis для сессий корзины
  - **Уровень изоляции:** Repeatable Read с пессимистическими блокировками для инвентаря
  - **Синхронизация:** Event-driven обновление цен через Kafka
  - **TTL:** Автоматическое удаление брошенных корзин через 24 часа

#### 6. **Gamification & Motivation Context**

- **Ответственность:** Система мотивации, достижения, рейтинги, награды
- **Ключевые агрегаты:**
  - `Achievement` (агрегат-корень) с `UnlockConditions`, `BadgeDesign`, `Rewards`
  - `Leaderboard` (агрегат-корень) с `Participants`, `Scores`, `TimeWindows`
  - `Reward` (агрегат-корень) с `DistributionRules`, `RedemptionOptions`, `Expiry`
- **Бизнес-правила:**
  - Прогрессивная сложность достижений
  - Ежедневные/еженедельные/ежемесячные лидерборды
  - Ограничение начисления очков: макс. 1000 очков в день
- **Управление данными:**
  - **Тип БД:** Redis для счетчиков и лидербордов + PostgreSQL для перманентных данных
  - **Согласованность:** Eventual consistency (приемлема для игровых механик)
  - **Производительность:** In-memory структуры Redis для real-time обновлений
  - **Резервное копирование:** Ежечасные снапшоты Redis RDB + AOF журналирование

 #### 7. **Event Management & Booking Context**

- **Ответственность:** Организация спортивных событий, бронирование мест, управление квотами
- **Ключевые агрегаты:**
  - `SportEvent` (агрегат-корень) с `Schedule`, `Venue`, `Capacity`, `RegistrationRules`
  - `Booking` (агрегат-корень) с `ReservedSeats`, `PaymentStatus`, `CancellationPolicy`
  - `Waitlist` (агрегат-корень) с `QueuePosition`, `NotificationPreferences`
- **Бизнес-правила:**
  - Приоритетное бронирование для премиум-пользователей (24-часовое окно)
  - Автоматическая отмена неоплаченных броней через 30 минут
  - Ограничение: макс. 2 события в день на пользователя
- **Управление данными:**
  - **Тип БД:** PostgreSQL с блокировками FOR UPDATE для управления местами
  - **Уровень изоляции:** Serializable для операций бронирования
  - **Стратегия резервирования:** Двухфазное подтверждение (проверка → блокировка → подтверждение)
  - **Таймауты:** Автоматический откат транзакций бронирования через 30 секунд

#### 8. **Analytics & Recommendations Context**

- **Ответственность:** Аналитика данных, ML рекомендации, персонализация
- **Ключевые агрегаты:**
  - `UserProfile` (агрегат-корень) с `BehaviorPatterns`, `Preferences`, `RecommendationHistory`
  - `AnalyticsReport` (агрегат-корень) с `Metrics`, `Trends`, `Insights`
  - `MLModel` (агрегат-корень) с `Version`, `Features`, `PerformanceMetrics`
- **Бизнес-правила:**
  - Минимальная история тренировок: 10 сессий для персонализации
  - Вес рекомендации: 60% история, 25% социальный граф, 15% популярное
  - Ежедневное обновление моделей рекомендаций
- **Управление данными:**
  - **Тип БД:** Cassandra для аналитических данных + PostgreSQL для метаданных моделей
  - **Согласованность:** Настраиваемая согласованность (QUORUM для важных данных, ONE для остальных)
  - **Обработка:** Lambda-архитектура (пакетная + потоковая обработка)
  - **Хранение:** Data Lake (S3) для сырых данных, Data Warehouse для агрегаций

## Стратегии управления транзакциями и согласованностью

### 1. Дифференцированные уровни согласованности

| Контекст | Уровень согласованности | Обоснование | Техническая реализация |
|----------|-------------------------|-------------|------------------------|
| Identity & Auth | Строгая | Безопасность и целостность учетных данных | PostgreSQL ACID, Repeatable Read |
| Event Booking | Строгая | Предотвращение двойного бронирования | Serializable, SELECT FOR UPDATE |
| Commerce | Строгая | Финансовая точность | Repeatable Read, пессимистические блокировки |
| Social Feed | Eventual | Производительность социальной ленты | Redis + асинхронная репликация |
| Gamification | Eventual | Игровые механики допускают задержки | Redis eventual consistency |
| Workout History | Eventual | История тренировок не критична к задержкам | MongoDB replica sets |

### 2. Паттерны управления распределенными операциями

#### Паттерн: Двухфазное подтверждение
- **Применение:** Бронирование мест на события
- **Реализация:** 
  1. Фаза подготовки: блокировка мест в Event Service
  2. Фаза подтверждения: создание бронирования в Booking Service
  3. Откат: автоматический при таймауте или ошибке

#### Паттерн: Компенсирующие транзакции
- **Применение:** Отмена участия в событии
- **Реализация:**
  1. Удаление бронирования
  2. Возврат денежных средств (если были)
  3. Уведомление пользователей в листе ожидания
  4. Восстановление доступности места

### 3. Многоуровневое кэширование

**Уровень 1: Локальный кэш (In-memory)**
- **Данные:** Сессии пользователей, активные тренировки
- **TTL:** 5-60 секунд
- **Технология:** Caffeine/Guava cache

**Уровень 2: Распределенный кэш (Redis Cluster)**
- **Данные:** Социальная лента, лидерборды, промоакции
- **TTL:** 5 минут - 24 часа
- **Технология:** Redis с кластеризацией

**Уровень 3: Персистентное хранилище**
- **Данные:** История тренировок, профили пользователей, транзакции
- **Технология:** PostgreSQL, MongoDB, TimescaleDB   

### 4. Паттерны обработки ошибок и отказоустойчивости

#### Идемпотентность критических операций
- **Применение:** Платежи, бронирования, регистрации
- **Реализация:** Idempotency-Key в заголовках запросов
- **Хранение состояния:** Redis с TTL 24 часа для результатов операций

#### Автоматическое освобождение ресурсов (TTL-механизмы)
- **Применение:** Временные резервирования мест, сессии корзин
- **Реализация:** Redis TTL для автоматической очистки
- **Таймауты:** 15 минут для бронирований, 30 минут для корзин

#### Обработка сетевых сбоев
- **Синхронные вызовы:** Circuit Breaker + Retry с exponential backoff
- **Асинхронные операции:** Dead Letter Queue для изоляции проблемных сообщений
- **Компенсирующие транзакции:** Автоматический откат распределенных операций при сбоях

### 4. Стратегии синхронизации данных

#### Event-Driven синхронизация
- **Механизм:** Apache Kafka для доменных событий
- **Применение:** Обновление социальной ленты, синхронизация лидербордов
- **Гарантии:** At-least-once delivery, идемпотентные потребители

#### TTL-Based инвалидация
- **Механизм:** Автоматическое удаление устаревших данных
- **Применение:** Сессии корзины, временные промоакции, кэши
- **Преимущества:** Автоматическая очистка, предсказуемое использование памяти

#### Пессимистические блокировки
- **Механизм:** SELECT FOR UPDATE в PostgreSQL
- **Применение:** Бронирование мест, управление инвентарем
- **Преимущества:** Предотвращение конфликтов, строгая согласованность

## Высокоуровневые компоненты системы

### 1. Сервис пользователей и аутентификации (Identity Service)
- **Назначение:** Управление профилями, аутентификация, авторизация
- **Соответствующий DDD контекст:** Identity & Authentication Context
- **Ключевые функции:**
  - Регистрация и вход (OAuth 2.0, JWT, MFA)
  - Управление профилем и настройками приватности
  - Роли и разрешения (RBAC)
  - Аудит действий пользователей
- **Управление данными:**
  - PostgreSQL для ACID-транзакций
  - Redis для сессий и rate limiting
  - Уровень изоляции: Repeatable Read

### 2. Сервис тренировок и активности (Workout Service)
- **Назначение:** Сбор, хранение и анализ данных о тренировках
- **Соответствующий DDD контекст:** Workout & Training Context
- **Ключевые функции:**
  - Трекинг активности в реальном времени
  - Интеграция с устройствами и датчиками
  - История и прогресс с бизнес-валидацией
  - Сравнение с прошлыми результатами и целями
- **Управление данными:**
  - MongoDB для гибкой схемы тренировок
  - Redis для активных сессий
  - Геопространственные индексы для маршрутов

### 3. Сервис социального взаимодействия (Social Service)
- **Назначение:** Социальные функции, группы, общение
- **Соответствующий DDD контекст:** Social & Community Context
- **Ключевые функции:**
  - Управление социальным графом (друзья, подписки)
  - Группы и сообщества с модерацией
  - Лента активности друзей и групп
  - Поиск по интересам и местоположению
- **Управление данными:**
  - PostgreSQL для социального графа
  - Redis для ленты новостей и кэширования
  - Eventual consistency для ленты

### 4. Движок геймификации (Gamification Engine)
- **Назначение:** Система мотивации через игровые механики
- **Соответствующий DDD контекст:** Gamification & Motivation Context
- **Ключевые функции:**
  - Баллы и уровни с динамическими правилами
  - Достижения и бейджи с условиями разблокировки
  - Рейтинговые таблицы в реальном времени
  - Награды и призы (виртуальные и физические)
- **Управление данными:**
  - Redis для счетчиков и лидербордов
  - PostgreSQL для перманентных данных
  - Eventual consistency для игровых механик

### 5. Сервис событий и бронирования (Event Service)
- **Назначение:** Организация событий и управление бронированиями
- **Соответствующий DDD контекст:** Event Management & Booking Context
- **Ключевые функции:**
  - Создание и управление спортивными событиями
  - Система бронирования мест с очередями ожидания
  - Управление квотами и доступностью
  - Интеграция с платежными системами
- **Управление данными:**
  - PostgreSQL с блокировками FOR UPDATE
  - Двухфазное резервирование мест
  - Строгая согласованность для бронирований

### 6. Сервис рекомендаций и аналитики (Recommendation Service)
- **Назначение:** Персонализированные рекомендации и аналитика
- **Соответствующий DDD контекст:** Analytics & Recommendations Context
- **Ключевые функции:**
  - ML-рекомендации тренировок на основе истории
  - Предложения по обновлению инвентаря
  - Рекомендации пользователей и групп
  - Аналитика поведения и трендов
- **Управление данными:**
  - Cassandra для аналитических данных
  - PostgreSQL для метаданных моделей
  - Lambda architecture для обработки

### 7. Сервис интеграции устройств (Device Integration Service)
- **Назначение:** Подключение и управление сторонними устройствами
- **Соответствующий DDD контекст:** Health & Device Integration Context
- **Ключевые функции:**
  - Поддержка протоколов (Bluetooth, ANT+, Wi-Fi)
  - Калибровка и валидация данных устройств
  - Обработка медицинских метрик в реальном времени
  - Оповещения о критических значениях
- **Управление данными:**
  - TimescaleDB для временных рядов
  - Хранение raw данных в S3-совместимом хранилище
  - Автоматическое сжатие старых данных

### 8. Сервис коммерции и промоакций (Commerce Service)
- **Назначение:** Управление продажами, промоакциями, интеграция с e-commerce
- **Соответствующий DDD контекст:** Commerce & Promotions Context
- **Ключевые функции:**
  - Каталог товаров с инвентарем
  - Система промоакций и скидок
  - Управление корзиной и сессиями покупок
  - Интеграция с платежными системами
- **Управление данными:**
  - PostgreSQL для ACID-транзакций
  - Redis для сессий корзины
  - Event-driven синхронизация цен

## Карта контекстов и их взаимодействий

### Типы связей между контекстами:

1. **Партнерство (Partnership):**
   - Между Social Context и Workout Context (социальные тренировки)
   - Между Gamification Context и Workout Context (награды за тренировки)

2. **Заказчик-Поставщик (Customer-Supplier):**
   - Workout Context → Device Context (запрос данных устройств)
   - Social Context → Recommendation Context (предоставление социального графа)

3. **Конформист (Conformist):**
   - Health Context → Медицинские стандарты (соответствие)
   - Commerce Context → E-commerce система компании (интеграция)

### Событийная шина и доменные события

#### Event Bus (Apache Kafka):
- **Назначение:** Асинхронная коммуникация между ограниченными контекстами
- **Топики по доменам:**
  - `identity-domain-events` - события Identity Context
  - `workout-domain-events` - события Workout Context
  - `social-domain-events` - события Social Context
  - `health-domain-events` - события Health Context
  - `commerce-domain-events` - события Commerce Context
  - `event-domain-events` - события Event Context
  - `gamification-domain-events` - события Gamification Context

#### Ключевые доменные события:

**Identity Context:**
- `UserRegisteredEvent` → триггер для welcome-серии
- `UserAuthenticatedEvent` → обновление активности
- `ProfileUpdatedEvent` → синхронизация между сервисами

**Workout Context:**
- `WorkoutStartedEvent` → начало отслеживания сессии
- `WorkoutCompletedEvent` → расчет статистики, проверка рекордов
- `PersonalRecordAchievedEvent` → обновление достижений

**Social Context:**
- `FriendshipEstablishedEvent` → обновление социального графа
- `GroupCreatedEvent` → инициализация модерации
- `ChallengeJoinedEvent` → добавление в лидерборд

**Health Context:**
- `HealthMetricRecordedEvent` → валидация и анализ
- `DeviceConnectedEvent` → калибровка и синхронизация
- `MedicalAlertTriggeredEvent` → уведомление пользователя

**Commerce Context:**
- `ProductViewedEvent` → обновление рекомендаций
- `PromotionAppliedEvent` → применение правил скидок
- `PurchaseCompletedEvent` → обновление инвентаря

**Event Context:**
- `EventCreatedEvent` → публикация в календаре
- `BookingConfirmedEvent` → резервирование места
- `EventCancelledEvent` → уведомление участников

**Gamification Context:**
- `AchievementUnlockedEvent` → уведомление, награждение
- `LeaderboardUpdatedEvent` → синхронизация рейтингов
- `RewardGrantedEvent` → доставка награды

## Стратегии управления транзакциями для критических операций

### Операция: Бронирование места на событии
1. Начало транзакции с уровнем Serializable
2. SELECT FOR UPDATE на доступные места
3. Проверка условий (доступность, квоты пользователя)
4. Создание записи бронирования
5. Отправка события BookingConfirmedEvent
6. Коммит транзакции
7. Компенсация при ошибке: автоматическая отмена брони

### Операция: Покупка товара с промокодом
1. Проверка инвентаря с блокировкой FOR UPDATE
2. Применение промокода и расчет цены
3. Создание заказа и привязка промокода
4. Списание инвентаря
5. Компенсация при ошибке: откат всех шагов

### Операция: Создание групповой тренировки
1. Проверка доступности участников
2. Резервирование виртуального "места" для каждого
3. Создание групповой сессии тренировки
4. Отправка уведомлений участникам
5. Асинхронная синхронизация данных между сервисами

## Бизнес-правила и валидация

### 1. Правила социального взаимодействия:
- Ограничение запросов в друзья: 50 в день
- Минимальный возраст для групп: 16 лет
- Правила модерации контента (автоматическая + ручная)

### 2. Валидация тренировочных данных:
- **Валидация частоты сердечных сокращений (ЧСС):**
  - Минимальное допустимое значение: 40 ударов в минуту
  - Максимальное допустимое значение: 220 - возраст пользователя
  - Автоматическое определение аномальных значений

### 3. Правила рекомендаций:
- Минимальная история тренировок: 10 сессий для персонализации
- Вес рекомендации: 60% история, 25% социальный граф, 15% популярное
- Ежедневное обновление ML-моделей

### 4. Правила бронирования:
- Приоритетное бронирование для премиум-пользователей (24-часовое окно)
- Автоматическая отмена неоплаченных броней через 30 минут
- Ограничение: макс. 2 события в день на пользователя
- Гарантия идемпотентности:** Все операции бронирования должны быть идемпотентными
- Автоматическое восстановление:** TTL-резервирования для освобождения мест при сбоях
- 
### 5. Правила геймификации:
- Прогрессивная сложность достижений
- Ежедневные/еженедельные/ежемесячные лидерборды
- Ограничение начисления очков: макс. 1000 очков в день

## Глобальная инфраструктура

### Мультиоблачная стратегия:
- **AWS (60%):** Основные регионы (США, Европа), Identity, Social, Workout контексты
- **Google Cloud (25%):** Азиатско-Тихоокеанский регион, Analytics, ML рекомендации
- **Azure (15%):** Корпоративные интеграции, Commerce, Health (HIPAA compliance)

### Геораспределение данных:
- **Региональные шарды:** Данные пользователей хранятся в их регионе (GDPR compliance)
- **Глобальная репликация:** Конфигурационные данные и каталоги товаров
- **CDN:** Статический контент (изображения, видео тренировок)
- **Edge-локации:** Кэширование для снижения задержки

### Кластеризация по доменам:

#### Регион: EU-West
- Identity-Cluster (PostgreSQL + Redis)
- Social-Cluster (PostgreSQL + Redis)
- Workout-Cluster (MongoDB + Redis)
- Health-Cluster (TimescaleDB + S3)

#### Регион: US-East
- Identity-Cluster (PostgreSQL + Redis)
- Commerce-Cluster (PostgreSQL + Redis)
- Event-Cluster (PostgreSQL с блокировками)
- Analytics-Cluster (Cassandra + Spark)

#### Регион: AP-Southeast
- Workout-Cluster (MongoDB + Redis)
- Gamification-Cluster (Redis + PostgreSQL)
- Social-Cluster (PostgreSQL + Redis)

## Преимущества подхода

1. **Четкое разделение ответственности:** Каждый контекст отвечает за свой домен
2. **Масштабируемость команд:** Разные команды могут работать над разными контекстами
3. **Эволюция архитектуры:** Контексты могут эволюционировать независимо
4. **Бизнес-фокус:** Архитектура отражает реальные бизнес-процессы
5. **Снижение сложности:** Сложность инкапсулирована внутри контекстов
6. **Дифференцированная согласованность:** Оптимальный баланс производительности и надежности
7. **Устойчивость к сбоям:** Изоляция отказов на уровне контекстов
8. **Гибкость развертывания:** Независимое развертывание сервисов

## Миграционная стратегия (от монолита к DDD-микросервисам)

1. **Фаза 1:** Выделение ограниченных контекстов в монолите
2. **Фаза 2:** Создание четких границ между модулями
3. **Фаза 3:** Экстракция контекстов в отдельные микросервисы
4. **Фаза 4:** Внедрение event-driven коммуникации между сервисами
5. **Фаза 5:** Оптимизация стратегий согласованности и транзакций

====================
